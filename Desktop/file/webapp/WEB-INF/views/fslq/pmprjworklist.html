<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head>
<title></title>
<template th:substituteby="framework/pageset.html"></template>
</head>
<body>
	<div id="app" view>
		<hy-filllayout rows="40,*" :showborder="true"  :showpadding="false"> 
			<hy-fillarea align="left">
	      		<div style="float:left">
					<hy-button text="添加" @click="add" :pkain="true"></hy-button>
					<hy-button text="保存" @click="save" :pkain="true"></hy-button>
					<hy-button text="删除" @click="remove" :pkain="true"></hy-button>
	      		</div>
			</hy-fillarea>
			<hy-fillarea>
	          <hy-table border name="dataWrap" id="ajaxgrid" showpage :readonly="false" height="100%"
				@queryfunc="query" titlealign="center" style="width: 99%">
				<hy-table-column title="序号" align="center" width="50" type="index"></hy-table-column>
				<hy-table-column title="多选" align="center" type="selection"></hy-table-column>
				<hy-table-column title="名称" name="workName" align="center" width="200" :rules="[{ required: true, message: '必填'}, {pattern: /^.{1,128}$/, message: '长度不能大于128'}]"></hy-table-column> 
				<hy-table-column title="单位" name="unit" align="center" width="200" :rules="[{ required: true, message: '必填'}, {pattern: /^.{1,128}$/, message: '长度不能大于128'}]"></hy-table-column> 
				<hy-table-column title="类型" name="workType" align="center" width="150" :rules="[{pattern: /^.{1,64}$/, message: '长度不能大于64'}]"></hy-table-column> 
				<hy-table-column title="完成工程量"  name="overNum" align="center" width="150" :maxlength="15" 
					:rules="[{ required: true},{pattern: /^\d{0,11}$|^\d{1,11}\.\d{1,3}$/ ,message: '只能为整数部分不大于11位小数部分不大于3位的数字' ,trigger: 'blur,change'}]"></hy-table-column> 
				<hy-table-column title="设计工程量"  name="designNum" align="center" width="150" :maxlength="15" 
					:rules="[{ required: true},{pattern: /^\d{0,11}$|^\d{1,11}\.\d{1,3}$/ ,message: '只能为整数部分不大于11位小数部分不大于3位的数字' ,trigger: 'blur,change'}]"></hy-table-column> 
<!-- 				<hy-table-column title="备注" type="remark" width="200" align="center"></hy-table-column> -->
			</hy-table> 
	      </hy-fillarea>
		</hy-filllayout>
	</div>
	<script th:inline="javascript">
		var vm = new Vue({
			el : "#app",
			data : {
			},
			mounted : function(){
				ajaxgrid.setData(response.getAjaxDataWrap("dataWrap"));
			},
			methods : {
				query : function(){
					var gridData = ajaxgrid.collectData(true) ;
					var dataArr = [];
					dataArr.push(gridData) ;
					$.request({
						url : $$pageContextPath + 'pmPrjWork/list',
						data : dataArr,
						params : {
							prjId : vm.prjId
						},
						success : function(response){
							ajaxgrid.setData(response.getAjaxDataWrap("dataWrap"));
						}
					});					
				},
				add : function(){
					$.request({
						url : $$pageContextPath + 'pmPrjWork/get',
						params : {
							prjId : vm.prjId
					   	},
						success : function(response){
							ajaxgrid.addRecord(response.getAjaxDataWrap("dataWrap").data);
						}
					});	
				},
				save : function(){
					debugger;
					var a = ajaxgrid.isValid();
					if (ajaxgrid.isValid()) {
						var gridData = ajaxgrid.collectData(true, "update");
						var dataArr = [];
						dataArr.push(gridData);
						$.request({
							url : $$pageContextPath + 'pmPrjWork/save',
							data : dataArr,
							success : vm.onsavecomplete
						});	
					}
				},
				remove : function(){
					var checked = ajaxgrid.getCheckedRecords();
					if (checked.length <= 0) {
						return setRM("alert", "请选择要删除的记录!");
					}else{
						$.confirm("提示","确定要删除选中的记录？",function(){
							var gridData = ajaxgrid.collectData(true, "checked");
							var dataArr = [];
							dataArr.push(gridData);
							$.request({
								url : $$pageContextPath + 'pmPrjWork/del',
								data : dataArr,
								success : function(response){
									setRM("success",response.getMessage(),vm.query());
								}
							});
					　　　},function(){});
					}
				}, 
				onsavecomplete : function(response){
					setRM("success",'保存成功',vm.query());
				}
			}
		});
	</script>
</body>
</html>
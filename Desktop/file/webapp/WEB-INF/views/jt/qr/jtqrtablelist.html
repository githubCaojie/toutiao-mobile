<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">

<head>
<title></title>
<template th:substituteby="framework/pageset.html"></template>
</head>
<body>
	<div id="app" view>
		<hy-filllayout rows="queryh,toolh,*" :showborder="true"  :showpadding="false"> 
			<hy-fillarea title="查询条件">
				 <table>
		              <tr>
		                <td align="right" width="100">类名</td>
						<td width="300"><hy-input name="dataWrap.query.classValue_LIKE"  v-model="entityClass" :upload="true" ></hy-input></td>
		                <td align="right" width="100">表名称</td>
						<td width="100"><hy-input name="dataWrap.query.tableName_LIKE" :upload="true" ></hy-input></td>
						<td align="right"width="80"><hy-button text="查询" @click="query"></hy-button></td>
						<td align="right"width="80"><hy-button text="初始化" @click="initEntity"></hy-button></td>
		              <tr />
		            </table>
			</hy-fillarea> 
		      <hy-fillarea align="right">
	      		<div style="float:left">
					<hy-button text="添加" @click="add"></hy-button>	
					<hy-button text="删除" @click="remove"></hy-button>	
	      		</div>
			</hy-fillarea>
			<hy-fillarea >
		          <hy-table border name="dataWrap"
						id="ajaxgrid" showpage :readonly="true" height="100%"
						@queryfunc="query" titlealign="center" style="width: 100%">
						<hy-table-column title="序号" align="center" width="60" type="index"></hy-table-column>
						<hy-table-column title="多选" align="center" type="selection"></hy-table-column> 
						<hy-table-column title="操作"  width="120" align="center">
					      <template scope="scope">
					     	 <a href="javascript:void(0)" @click="detail(scope.row)">详情</a>&nbsp;
					     	 <a href="javascript:void(0)" @click="fields(scope.row)">字段详情</a>&nbsp;
					      </template>
					    </hy-table-column>
						<hy-table-column title="表名"  name="tableValue" align="center" width="150" ></hy-table-column> 
						<hy-table-column title="表名称"  name="tableName" align="center" width="150" ></hy-table-column> 
						<hy-table-column title="实体"  name="entityValue" align="center" width="300" ></hy-table-column> 
						<hy-table-column title="表类型"  name="dataType" type="drop" dropname="JT.QR_TABLE_TYPE" align="center" width="100" ></hy-table-column> 
						<hy-table-column title="扩展表"  name="extTable" align="center" width="100" ></hy-table-column> 
						<hy-table-column title="备注"  name="remark" align="center" width="150" ></hy-table-column> 
					</hy-table>  
		      </hy-fillarea>
		</hy-filllayout>
	</div>
	<script th:inline="javascript">
	var perUuid;
	var vm = new Vue({
		el : "#app",
		data : {
			entityClass:''
		},
		mounted : function(){
			ajaxgrid.setData(response.getAjaxDataWrap("dataWrap"));
		},
		methods : {				
			query : function(){
				var gridData = ajaxgrid.collectData(true) ;
				var dataArr = [];
				dataArr.push(gridData) ;
				$.request({
					url : $$pageContextPath + 'jt/jtQrTable/query',
					data : dataArr,
					success : function(response){
						ajaxgrid.setData(response.getAjaxDataWrap("dataWrap"));
					}
				});					
			},
			detail : function(row){
				$.popWindow({
					url:$$pageContextPath + 'jt/jtQrTable/queryOne?editFlag=Y&id='+row.id,
					title: "详细",
					callback: vm.onsavecomplete,
					css:{width:800,height:400},
					button:0,
					isRunCallback :true
				});
			},
			fields : function(row){
				$.popWindow({
					url:$$pageContextPath + 'jt/jtQrTableField/?editFlag=Y&tableId='+row.id,
					title: "详细",
					callback: vm.onsavecomplete,
					css:{width:1000,height:650},
					button:0,
					isRunCallback :true
				});
			},
			initEntity : function(row){
				$.request({
					url : $$pageContextPath + 'jt/jtQrTable/initEntity',
					params : {'entityClass':this.entityClass},
					success : function(response){
						setRM("success",response.getMessage(),vm.query());
					}
				});					
			},
			add : function(){
				$.popWindow({
					url:$$pageContextPath + 'jt/jtQrTable/queryOne?editFlag=Y',
					title: "添加",
					callback: vm.onsavecomplete,
					css:{width:800,height:400},
					button:0,
					isRunCallback :true
				});
			},
			remove : function(){
				var checked = ajaxgrid.getCheckedRecords();
				if (checked.length <= 0) {
					$.alert("error", "请选择要删除的记录!");
				}else{
					$.confirm("提示","确定要删除选中的记录？",function(){
						var gridData = ajaxgrid.collectData(true, "checked");
						var dataArr = [];
						dataArr.push(gridData);
						$.request({
							url : $$pageContextPath + 'jt/jtQrTable/remove',
							data : dataArr,
							success : function(response){
								setRM("success",response.getMessage(),vm.query());
							}
						});
				　　　},function(){});
				}
				
			},
			onsavecomplete : function(response,b,c){
				vm.query();
			}
		}
		
	});
	</script>
</body>
</html>
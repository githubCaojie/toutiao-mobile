<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head>
<title></title>
<template th:substituteby="framework/pageset.html"></template>
</head>
<body>
	<div id="app" view>
	<hy-filllayout rows="35,*" :showborder="true"  :showpadding="false"> 
			<hy-fillarea :display="editFlag=='N'?'none':'block'">
				<hy-button text="保存" @click="save"></hy-button>	
			</hy-fillarea>
			<hy-fillarea >
				<hy-form id="myform" name="dataWrap" 
					label-position="left" :labelwidth="100" :readonly="editFlag=='N'"
					label-suffix="：" :cols="2" size="normal"> 
					<hy-formgroup title="基本信息">
						<hy-forminputbutton label="姓名" name="partyId" @click="selectPerson" v-model="perId" :rules="{ required: true}"
							labelprovider="com.haiyisoft.jt.right.labelprovider.RightPerNameLabel" placeholder="不能手动输入，请弹窗选人" :editable="false"> </hy-forminputbutton>
						<hy-forminputbutton name="orgId" label="原部门" :readonly="true" v-model="oldOrgId"
							labelprovider="com.haiyisoft.hr.org.labelprovider.OrgNameLabel"></hy-forminputbutton>
						<hy-forminputbutton name="chgOrgId" label="变更部门" @click="selectOrg" v-model="orgId" :required="true"
							labelprovider="com.haiyisoft.hr.org.labelprovider.OrgNameLabel"></hy-forminputbutton>
						<hy-forminputbutton label="变更人" name="updateMan" :readonly="true"
							labelprovider="com.haiyisoft.jt.right.labelprovider.RightPerNameLabel" > </hy-forminputbutton>
						<hy-formdatepicker label="变更时间" name="updateTime" :readonly="true" ></hy-formdatepicker>
					</hy-formgroup>
				</hy-form> 
		    </hy-fillarea>
		</hy-filllayout>
	</div>
	<script th:inline="javascript">
		var vm = new Vue({
			el : "#app",
			data : {
				oldOrgId : null,
				perId : null,
				orgId : null
			},
			mounted : function(){
				myform.setRecord(response.getAjaxDataWrap("dataWrap").getData()) ;
			},
			methods : {	
				save : function(){
					myform.validate(function(data){
						if(data){
							$.confirm("提示", "确定要更新到人员档案？", function() {
								var formData = myform.collectData();
								var dataArr = [];
								dataArr.push(formData);
								$.request({
									url : $$pageContextPath + 'per/perChg/save',
									data : dataArr,
									success : function(response){
										setRM(function(){$.close('')});
									}
								});
							}, function() {
							});
							
						}	
					});
				},
				selectOrg : function(){
					$.showModalDialog($$pageContextPath + 'hr/selectOrg/oneOrg', "选择变更部门", vm.selectOrgComp, null, 600, 400,
							0);
				},
				selectOrgComp : function(data){
					this.orgId = data.partyId;
				},
				selectPerson : function(){
					$.showModalDialog($$pageContextPath + "jt/right/selectPer/onePer", "选择人员", vm.selectPersonComp, null, 800, 460, 0);
				},
				selectPersonComp : function(data){
					this.perId = data.partyId;
					this.oldOrgId = data.orgId;
				}
			}
		});
	</script>
</body>
</html>